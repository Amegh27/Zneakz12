<%- include("../partials/user/header2") %>

<style>
  :root {
    --primary-dark: #1a1a1a;
    --primary-light: #ffffff;
    --border-gray: #e0e0e0;
    --text-muted: #666666;
  }

  body {
    background: linear-gradient(135deg, #f9f9f9 0%, #ffffff 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow-x: hidden;
  }

  .wishlist-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 120px 20px 60px;
  }

  h2 {
    /* background: linear-gradient(135deg, var(--primary-dark), #333333);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 2.5rem; */
    text-align: center;
    margin-bottom: 40px;
  }

  .card {
    border: 1px solid var(--border-gray);
    border-radius: 12px;
    transition: all 0.3s ease;
    background: var(--primary-light);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .card-img-top {
    height: 250px;
    object-fit: cover;
    border-radius: 12px 12px 0 0;
  }

  .card-body {
    padding: 20px;
  }

  .card-body h6 {
    font-weight: 600;
    color: var(--primary-dark);
    min-height: 2.8em;
  }

  .text-danger {
    color: #d32f2f !important;
    font-size: 1.1rem;
  }

  .move-to-cart,
  .remove-wishlist-btn {
    border-radius: 6px;
    font-weight: 600;
    transition: all 0.3s ease;
    padding: 8px 12px;
    width: 100%;
  }

  .move-to-cart {
    background: var(--primary-dark);
    color: var(--primary-light);
    border: 2px solid var(--primary-dark);
  }

  .move-to-cart:hover {
    background: var(--primary-light);
    color: var(--primary-dark);
  }

  .remove-wishlist-btn {
    background: #fff;
    color: #d32f2f;
    border: 2px solid #d32f2f;
  }

  .remove-wishlist-btn:hover {
    background: #d32f2f;
    color: #fff;
  }

  @media (max-width: 768px) {
    .wishlist-container { padding: 100px 15px 50px; }
  }
</style>

<div class="wishlist-container">
  <h2>My Wishlist</h2>

  <% if (products && products.length > 0) { %>
    <div class="row g-4">
      <% products.forEach(product => { %>
        <div class="col-md-3 col-sm-6">
          <div class="card h-100 text-center">
            <img src="/uploads/products/<%= product.productImage[0] %>" class="card-img-top" alt="<%= product.productName %>">
            <div class="card-body">
              <h6><%= product.productName %></h6>
             <% if (product.discountPrice && product.discountPrice < product.price) { %>
  <p class="mb-1 text-muted text-decoration-line-through">
    Rs <%= product.price.toFixed(0) %>
  </p>
  <p class="fw-bold text-danger">
    Rs <%= product.discountPrice.toFixed(0) %>
  </p>
<% } else { %>
  <p class="fw-bold">
    Rs <%= product.price.toFixed(0) %>
  </p>
<% } %>


              <button class="btn move-to-cart mt-2" data-id="<%= product._id %>">
                Move to Cart
              </button>
              <button class="btn remove-wishlist-btn mt-2" data-id="<%= product._id %>">
                Remove from Wishlist
              </button>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="text-center py-5">
      <i class="bi bi-heart fs-1 text-muted"></i>
      <h5 class="mt-3">Your wishlist is empty.</h5>
      <a href="/" class="btn btn-dark mt-2">Browse Products</a>
    </div>
  <% } %>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.querySelectorAll('.remove-wishlist-btn').forEach(btn => {
  btn.addEventListener('click', async () => {
    const productId = btn.dataset.id;
    const res = await fetch(`/wishlist/remove/${productId}`, { method: 'DELETE' });
    const data = await res.json();
    if (data.success) {
      btn.closest('.col-md-3').remove();
      if (document.querySelectorAll('.col-md-3').length === 0) location.reload();
    } else {
      alert(data.message);
    }
  });
});


document.querySelectorAll('.move-to-cart').forEach(btn => {
  btn.addEventListener('click', async () => {
    const productId = btn.dataset.id;

    try {
      const res = await fetch(`/wishlist/move-to-cart/${productId}`, {
        method: 'POST',
        credentials: 'include'
      });
      const data = await res.json();

      if (data.success) {
        showToast('Moved to cart successfully', 'success');
        setTimeout(() => location.reload(), 1000);
      } else {
        showToast(data.message || 'Failed to move item', 'danger');
      }
    } catch (error) {
      console.error('Move to cart error:', error);
      showToast('Network error', 'danger');
    }
  });
});

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast align-items-center text-white bg-${type} border-0 position-fixed`;
  toast.style.top = '20px';
  toast.style.right = '20px';
  toast.style.zIndex = '1055';
  toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">${message}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  `;

  document.body.appendChild(toast);
  const bsToast = new bootstrap.Toast(toast, { delay: 2000 });
  bsToast.show();

  toast.addEventListener('hidden.bs.toast', () => toast.remove());
}
</script>

<%- include('../partials/user/footer') %>
